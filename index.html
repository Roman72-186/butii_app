<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Beauty Studio</title>

    <!-- Telegram Web App Script -->
    <script src="https://telegram.org/js/telegram-web-app.js"></script>

    <!-- Supabase -->
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>

    <!-- Styles -->
    <link rel="stylesheet" href="css/style.css">

    <!-- Favicon -->
    <link rel="icon" type="image/svg+xml" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='.9em' font-size='90'>üíÖ</text></svg>">
</head>
<body>
    <!-- Loader -->
    <div id="loader" class="loader">
        <div class="loader-spinner"></div>
    </div>

    <!-- Main Container -->
    <div id="app" class="container" style="display: none;">

        <!-- Header -->
        <header class="header">
            <div class="header-content">
                <div class="logo" onclick="switchTab('services')" id="headerLogo">
                    <span class="logo-icon" id="studioLogo">üíÖ</span>
                    <span class="logo-text" id="studioName">Beauty Studio</span>
                </div>
            </div>
        </header>

        <!-- ==========================================
             –¢–ê–ë 1: –£–°–õ–£–ì–ò (booking flow)
             ========================================== -->
        <div id="tabServices" class="tab-content active">

            <section class="services-section" id="servicesSection">
                <div class="categories-scroll">
                    <div class="categories" id="categories"></div>
                </div>
                <div class="services-grid" id="servicesGrid"></div>
            </section>

            <section class="masters-section" id="mastersSection" style="display: none;">
                <div class="section-header">
                    <button class="back-btn" onclick="showServices()">
                        <span class="back-icon">‚Üê</span> –ù–∞–∑–∞–¥
                    </button>
                    <h2>–í—ã–±–µ—Ä–∏—Ç–µ –º–∞—Å—Ç–µ—Ä–∞</h2>
                </div>
                <div class="selected-service-card" id="selectedServiceCard"></div>
                <div class="masters-list" id="mastersList"></div>
            </section>

            <section class="booking-section" id="bookingSection" style="display: none;">
                <div class="section-header">
                    <button class="back-btn" onclick="goBackFromBooking()">
                        <span class="back-icon">‚Üê</span> –ù–∞–∑–∞–¥
                    </button>
                    <h2>–í—ã–±–µ—Ä–∏—Ç–µ –¥–∞—Ç—É –∏ –≤—Ä–µ–º—è</h2>
                </div>
                <div class="booking-info-card" id="bookingInfoCard"></div>
                <div class="calendar-section">
                    <h3 class="calendar-title">–í—ã–±–µ—Ä–∏—Ç–µ –¥–∞—Ç—É</h3>
                    <div class="calendar-scroll">
                        <div class="calendar-days" id="calendarDays"></div>
                    </div>
                </div>
                <div class="time-section" id="timeSection" style="display: none;">
                    <h3 class="time-title">–í—ã–±–µ—Ä–∏—Ç–µ –≤—Ä–µ–º—è</h3>
                    <div class="time-slots" id="timeSlots"></div>
                </div>
                <div class="booking-actions" id="bookingActions" style="display: none;">
                    <button class="btn-primary" onclick="showConfirmation()">
                        <span>–ü—Ä–æ–¥–æ–ª–∂–∏—Ç—å</span>
                        <span class="btn-arrow">‚Üí</span>
                    </button>
                </div>
            </section>

            <section class="confirmation-section" id="confirmationSection" style="display: none;">
                <div class="section-header">
                    <button class="back-btn" onclick="showBooking()">
                        <span class="back-icon">‚Üê</span> –ù–∞–∑–∞–¥
                    </button>
                    <h2>–ü–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ –∑–∞–ø–∏—Å–∏</h2>
                </div>
                <div class="confirmation-card">
                    <div class="confirmation-details" id="confirmationDetails"></div>
                </div>
                <form id="bookingForm" onsubmit="submitBooking(event)">
                    <div class="form-section">
                        <h3>–ö–æ–Ω—Ç–∞–∫—Ç–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ</h3>
                        <div class="form-group">
                            <label for="customerName">–ò–º—è *</label>
                            <input type="text" id="customerName" required placeholder="–í–≤–µ–¥–∏—Ç–µ –≤–∞—à–µ –∏–º—è">
                        </div>
                        <div class="form-group">
                            <label for="customerPhone">–¢–µ–ª–µ—Ñ–æ–Ω *</label>
                            <input type="tel" id="customerPhone" required placeholder="+7 (___) ___-__-__">
                        </div>
                        <div class="form-group">
                            <label for="customerComment">–ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π (–Ω–µ–æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ)</label>
                            <textarea id="customerComment" rows="3" placeholder="–í–∞—à–∏ –ø–æ–∂–µ–ª–∞–Ω–∏—è"></textarea>
                        </div>
                    </div>
                    <button type="submit" class="btn-primary" id="submitBookingBtn">
                        <span>–ó–∞–ø–∏—Å–∞—Ç—å—Å—è</span>
                        <span id="bookingPrice">0 ‚ÇΩ</span>
                    </button>
                </form>
            </section>

            <section class="success-section" id="successSection" style="display: none;">
                <div class="success-animation">
                    <div class="success-icon">‚úì</div>
                </div>
                <h2>–í—ã –∑–∞–ø–∏—Å–∞–Ω—ã!</h2>
                <p class="success-message">–ñ–¥—ë–º –≤–∞—Å –≤ —É–∫–∞–∑–∞–Ω–Ω–æ–µ –≤—Ä–µ–º—è.</p>
                <div class="success-details" id="successDetails"></div>
                <div class="success-actions">
                    <button class="btn-primary" onclick="switchTab('bookings')">
                        <span>–ú–æ–∏ –∑–∞–ø–∏—Å–∏</span>
                        <span class="btn-arrow">‚Üí</span>
                    </button>
                    <button class="btn-secondary" onclick="resetApp()">
                        –ó–∞–ø–∏—Å–∞—Ç—å—Å—è –µ—â—ë
                    </button>
                </div>
            </section>

        </div>

        <!-- ==========================================
             –¢–ê–ë 2: –ú–û–ò –ó–ê–ü–ò–°–ò
             ========================================== -->
        <div id="tabBookings" class="tab-content">
            <section class="my-bookings-section" id="myBookingsSection">
                <h2 class="tab-title">–ú–æ–∏ –∑–∞–ø–∏—Å–∏</h2>

                <div id="noBookings" class="empty-state">
                    <div class="empty-icon">üìÖ</div>
                    <h3>–ó–∞–ø–∏—Å–µ–π –ø–æ–∫–∞ –Ω–µ—Ç</h3>
                    <p>–ó–∞–ø–∏—à–∏—Ç–µ—Å—å –Ω–∞ —É—Å–ª—É–≥—É, –∏ –æ–Ω–∞ –ø–æ—è–≤–∏—Ç—Å—è –∑–¥–µ—Å—å</p>
                    <button class="btn-secondary" onclick="switchTab('services')">–í—ã–±—Ä–∞—Ç—å —É—Å–ª—É–≥—É</button>
                </div>

                <div id="bookingsList" class="bookings-list" style="display: none;">
                    <div class="bookings-group" id="upcomingBookings">
                        <h3 class="bookings-group-title">–ü—Ä–µ–¥—Å—Ç–æ—è—â–∏–µ</h3>
                        <div class="bookings-items" id="upcomingBookingsItems"></div>
                    </div>
                    <div class="bookings-group" id="pastBookings" style="display: none;">
                        <h3 class="bookings-group-title">–ü—Ä–æ—à–µ–¥—à–∏–µ</h3>
                        <div class="bookings-items" id="pastBookingsItems"></div>
                    </div>
                </div>
            </section>
        </div>

        <!-- ==========================================
             –¢–ê–ë 3: –ë–û–ù–£–°–´ / –õ–û–Ø–õ–¨–ù–û–°–¢–¨
             ========================================== -->
        <div id="tabBonuses" class="tab-content">
            <section class="bonuses-section">
                <h2 class="tab-title">–ú–æ–∏ –±–æ–Ω—É—Å—ã</h2>

                <!-- –ö–∞—Ä—Ç–∞ –ª–æ—è–ª—å–Ω–æ—Å—Ç–∏ -->
                <div class="loyalty-card">
                    <div class="loyalty-card-bg">
                        <div class="loyalty-card-logo">üíÖ Beauty Studio</div>
                        <div class="loyalty-card-name" id="loyaltyName">–ì–æ—Å—Ç—å</div>
                        <div class="loyalty-card-balance">
                            <span class="loyalty-balance-value" id="loyaltyBalance">0</span>
                            <span class="loyalty-balance-label">–±–æ–Ω—É—Å–æ–≤</span>
                        </div>
                    </div>
                </div>

                <!-- –†–µ—Ñ–µ—Ä–∞–ª—å–Ω–∞—è —Å—Å—ã–ª–∫–∞ -->
                <div class="cabinet-card">
                    <div class="cabinet-card-header">
                        <span class="cabinet-card-icon">üë•</span>
                        <span>–ü—Ä–∏–≥–ª–∞—Å–∏ –¥—Ä—É–≥–∞</span>
                    </div>
                    <p class="cabinet-card-desc">–ü–æ–¥–µ–ª–∏—Ç–µ—Å—å —Å—Å—ã–ª–∫–æ–π –∏ –ø–æ–ª—É—á–∏—Ç–µ –±–æ–Ω—É—Å—ã –∑–∞ –∫–∞–∂–¥–æ–≥–æ –¥—Ä—É–≥–∞</p>
                    <div class="ref-link-box">
                        <span id="refLink" class="ref-link-text">–í–æ–π–¥–∏—Ç–µ –≤ –∫–∞–±–∏–Ω–µ—Ç</span>
                        <button class="btn-sm btn-copy" onclick="copyRefLink()">–ö–æ–ø–∏—Ä–æ–≤–∞—Ç—å</button>
                    </div>
                </div>

                <!-- –ú–æ–∏ —Ä–µ—Ñ–µ—Ä–∞–ª—ã -->
                <div class="cabinet-card" onclick="showCabinetView('myRefs')">
                    <div class="cabinet-card-row">
                        <div class="cabinet-card-left">
                            <span class="cabinet-card-icon">ü§ù</span>
                            <span>–ú–æ–∏ —Ä–µ—Ñ–µ—Ä–∞–ª—ã</span>
                        </div>
                        <span class="cabinet-card-arrow">‚Üí</span>
                    </div>
                </div>

                <!-- –ê—Ä—Ö–∏–≤ –∑–∞–ø–∏—Å–µ–π -->
                <div class="cabinet-card" onclick="showCabinetView('archiveBookings')">
                    <div class="cabinet-card-row">
                        <div class="cabinet-card-left">
                            <span class="cabinet-card-icon">üìÅ</span>
                            <span>–ê—Ä—Ö–∏–≤ –∑–∞–ø–∏—Å–µ–π</span>
                        </div>
                        <span class="cabinet-card-arrow">‚Üí</span>
                    </div>
                </div>
            </section>
        </div>

        <!-- ==========================================
             –¢–ê–ë 4: –ö–ê–ë–ò–ù–ï–¢
             ========================================== -->
        <div id="tabCabinet" class="tab-content">

            <!-- –ì–æ—Å—Ç–µ–≤–æ–π –≤–∏–¥ (–¥–æ –≤—Ö–æ–¥–∞) -->
            <div id="cabinetGuest">
                <h2 class="tab-title">–ö–∞–±–∏–Ω–µ—Ç</h2>

                <!-- –û —Å–∞–ª–æ–Ω–µ -->
                <div class="cabinet-card about-card">
                    <div class="about-logo">üíÖ</div>
                    <h3>Beauty Studio</h3>
                    <p id="aboutAddress">–≥. –ú–æ—Å–∫–≤–∞, —É–ª. –ö—Ä–∞—Å–æ—Ç—ã, –¥. 1</p>
                    <p id="aboutPhone">+7 (999) 123-45-67</p>
                    <p class="about-hours">–ü–Ω‚Äì–°–±: 9:00 ‚Äì 20:00</p>
                </div>

                <!-- –ö–Ω–æ–ø–∫–∞ –≤—Ö–æ–¥–∞ -->
                <button class="btn-primary cabinet-login-btn" onclick="showLoginForm()">
                    <span>üë§</span> –í–æ–π—Ç–∏ –≤ –∫–∞–±–∏–Ω–µ—Ç
                </button>
            </div>

            <!-- –§–æ—Ä–º–∞ –≤—Ö–æ–¥–∞ -->
            <div id="cabinetLogin" style="display:none;">
                <div class="section-header">
                    <button class="back-btn" onclick="hideLoginForm()">
                        <span class="back-icon">‚Üê</span> –ù–∞–∑–∞–¥
                    </button>
                    <h2>–í—Ö–æ–¥</h2>
                </div>

                <div class="login-form-wrap">
                    <p class="login-hint">–í—Ö–æ–¥ –¥–ª—è –∫–ª–∏–µ–Ω—Ç–æ–≤</p>
                    <form onsubmit="handleCabinetLogin(event)">
                        <div class="form-group">
                            <label>–¢–µ–ª–µ—Ñ–æ–Ω</label>
                            <input type="tel" id="cabinetPhone" placeholder="+7 (___) ___-__-__" required>
                        </div>
                        <div class="form-group">
                            <label>–ü–∞—Ä–æ–ª—å</label>
                            <input type="password" id="cabinetPassword" placeholder="–í–≤–µ–¥–∏—Ç–µ –ø–∞—Ä–æ–ª—å" required>
                        </div>
                        <div id="cabinetLoginError" class="login-error" style="display:none;"></div>
                        <button type="submit" class="btn-primary" id="cabinetLoginBtn">–í–æ–π—Ç–∏</button>
                    </form>
                    <p class="auth-switch">–ù–µ—Ç –∞–∫–∫–∞—É–Ω—Ç–∞? <a href="#" onclick="showRegisterForm(); return false;">–ó–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞—Ç—å—Å—è</a></p>
                </div>
            </div>

            <!-- –§–æ—Ä–º–∞ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏ -->
            <div id="cabinetRegister" style="display:none;">
                <div class="section-header">
                    <button class="back-btn" onclick="hideRegisterForm()">
                        <span class="back-icon">‚Üê</span> –ù–∞–∑–∞–¥
                    </button>
                    <h2>–†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è</h2>
                </div>

                <div class="login-form-wrap">
                    <p class="login-hint">–°–æ–∑–¥–∞–π—Ç–µ –∞–∫–∫–∞—É–Ω—Ç –∫–ª–∏–µ–Ω—Ç–∞</p>
                    <form onsubmit="handleCabinetRegister(event)">
                        <div class="form-group">
                            <label>–ò–º—è</label>
                            <input type="text" id="registerName" placeholder="–í–∞—à–µ –∏–º—è" required>
                        </div>
                        <div class="form-group">
                            <label>–¢–µ–ª–µ—Ñ–æ–Ω</label>
                            <input type="tel" id="registerPhone" placeholder="+7 (___) ___-__-__" required>
                        </div>
                        <div class="form-group">
                            <label>–ü–∞—Ä–æ–ª—å</label>
                            <input type="password" id="registerPassword" placeholder="–ú–∏–Ω–∏–º—É–º 6 —Å–∏–º–≤–æ–ª–æ–≤" required minlength="6">
                        </div>
                        <div class="form-group">
                            <label>–ü–æ–¥—Ç–≤–µ—Ä–¥–∏—Ç–µ –ø–∞—Ä–æ–ª—å</label>
                            <input type="password" id="registerPasswordConfirm" placeholder="–ü–æ–≤—Ç–æ—Ä–∏—Ç–µ –ø–∞—Ä–æ–ª—å" required>
                        </div>
                        <div id="cabinetRegisterError" class="login-error" style="display:none;"></div>
                        <button type="submit" class="btn-primary" id="cabinetRegisterBtn">–ó–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞—Ç—å—Å—è</button>
                    </form>
                    <p class="auth-switch">–£–∂–µ –µ—Å—Ç—å –∞–∫–∫–∞—É–Ω—Ç? <a href="#" onclick="showLoginForm(); return false;">–í–æ–π—Ç–∏</a></p>
                </div>
            </div>

            <!-- –ü—Ä–æ—Ñ–∏–ª—å (–ø–æ—Å–ª–µ –≤—Ö–æ–¥–∞) -->
            <div id="cabinetProfile" style="display:none;">
                <h2 class="tab-title">–ö–∞–±–∏–Ω–µ—Ç</h2>

                <!-- –ö–∞—Ä—Ç–æ—á–∫–∞ –ø—Ä–æ—Ñ–∏–ª—è -->
                <div class="profile-card">
                    <div class="profile-avatar" id="profileAvatar">üë§</div>
                    <div class="profile-info">
                        <div class="profile-name" id="profileName"></div>
                        <div class="profile-role" id="profileRole"></div>
                    </div>
                </div>

                <!-- –ú–µ–Ω—é –ø—Ä–æ—Ñ–∏–ª—è -->
                <div id="profileMenu" class="profile-menu"></div>

                <!-- –ö–æ–Ω—Ç–µ–Ω—Ç –ø–æ–¥–≤–∏–¥–æ–≤ (—Ä–∞—Å–ø–∏—Å–∞–Ω–∏–µ, —Ä–µ—Ñ–µ—Ä–∞–ª—ã –∏ —Ç.–¥.) -->
                <div id="cabinetSubview" style="display:none;">
                    <div class="section-header">
                        <button class="back-btn" onclick="closeCabinetSubview()">
                            <span class="back-icon">‚Üê</span> –ù–∞–∑–∞–¥
                        </button>
                        <h2 id="cabinetSubviewTitle"></h2>
                    </div>
                    <div id="cabinetSubviewContent"></div>
                </div>

                <!-- –ö–Ω–æ–ø–∫–∞ –≤—ã—Ö–æ–¥–∞ -->
                <button class="btn-logout" onclick="handleCabinetLogout()">–í—ã–π—Ç–∏ –∏–∑ –∫–∞–±–∏–Ω–µ—Ç–∞</button>
            </div>

        </div>

        <!-- ==========================================
             –ù–ò–ñ–ù–Ø–Ø –ù–ê–í–ò–ì–ê–¶–ò–Ø
             ========================================== -->
        <nav id="bottomNav" class="bottom-nav">
            <button class="tab-btn active" data-tab="services" onclick="switchTab('services')">
                <span class="tab-btn-icon">‚ú®</span>
                <span class="tab-btn-label">–£—Å–ª—É–≥–∏</span>
            </button>
            <button class="tab-btn" data-tab="bookings" onclick="switchTab('bookings')" style="display:none;">
                <span class="tab-btn-icon">üìã</span>
                <span class="tab-btn-label">–ó–∞–ø–∏—Å–∏</span>
                <span class="tab-btn-badge" id="tabBookingsBadge" style="display:none;">0</span>
            </button>
            <button class="tab-btn" data-tab="bonuses" onclick="switchTab('bonuses')" style="display:none;">
                <span class="tab-btn-icon">üéÅ</span>
                <span class="tab-btn-label">–ë–æ–Ω—É—Å—ã</span>
            </button>
            <button class="tab-btn" data-tab="cabinet" onclick="switchTab('cabinet')">
                <span class="tab-btn-icon">üë§</span>
                <span class="tab-btn-label">–ö–∞–±–∏–Ω–µ—Ç</span>
            </button>
        </nav>

    </div>

    <!-- –°–∫—Ä—ã—Ç–∞—è —Ñ–æ—Ä–º–∞ –≤—Ö–æ–¥–∞ —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–∞ (—Ç—Ä–æ–π–Ω–æ–π –∫–ª–∏–∫ –Ω–∞ –ª–æ–≥–æ—Ç–∏–ø) -->
    <div id="staffLoginOverlay" class="staff-overlay" style="display:none;" onclick="if(event.target===this)hideStaffLogin()">
        <div class="staff-modal">
            <div class="staff-modal-header">
                <h3>–í—Ö–æ–¥ –¥–ª—è —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–æ–≤</h3>
                <button class="staff-modal-close" onclick="hideStaffLogin()">&times;</button>
            </div>
            <form onsubmit="handleStaffLogin(event)">
                <div class="form-group">
                    <label>–¢–µ–ª–µ—Ñ–æ–Ω</label>
                    <input type="tel" id="staffPhone" placeholder="+7 (___) ___-__-__" required>
                </div>
                <div class="form-group">
                    <label>–ü–∞—Ä–æ–ª—å</label>
                    <input type="password" id="staffPassword" placeholder="–ü–∞—Ä–æ–ª—å" required>
                </div>
                <div id="staffLoginError" class="login-error" style="display:none;"></div>
                <button type="submit" class="btn-primary" id="staffLoginBtn">–í–æ–π—Ç–∏</button>
            </form>
        </div>
    </div>

    <!-- Scripts -->
    <script src="js/supabase-config.js"></script>
    <script src="js/config.js"></script>
    <script src="js/telegram.js"></script>
    <script src="js/booking.js"></script>
    <script src="js/app.js"></script>
    <script src="js/cabinet.js"></script>
</body>
</html>
